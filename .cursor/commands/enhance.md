# 機能追加作業開始コマンド

このコマンドは、機能追加・機能拡張作業を開始するための専用コマンドです。

## 使用方法

```
/enhance <Issue URL または Issue番号> <簡単な説明>
```

**例**:
- `/enhance #92 採掘速度計算機能`
- `/enhance https://github.com/owner/repo/issues/92 採掘速度計算機能`
- `/enhance #92` (説明なしの場合はIssueタイトルを使用)

## 実行内容

このコマンドを実行すると、`@development-workflow.mdc` の**全ステップを必ず自動的に実行**します：

### 1. Issue情報の抽出
- Issue URL または Issue番号から Issue 番号を抽出
- Issue番号は PR作成時に自動的に紐付けられます

### 2. 作業タイプの判定とブランチ作成
- **作業タイプ**: **機能エンハンス**
- **ベースブランチ**: `develop`
- **ブランチ命名規則**: `feature/<機能名のスラッグ化>`
- **例**: `feature/mining-calculator`
- **コミットプレフィックス**: `feat:`
- **PR先**: `develop` ブランチ

### 3. 必須実行ステップ（全11ステップ）

`@development-workflow.mdc` の**全ステップを必ず自動的に実行**：

#### ✅ **ステップ 1**: 作業タイプの判定とブランチ作成 🔴 必須実行
- [ ] **作業タイプを判定**（必ず実行すること）
  - **機能エンハンス** (`feature/*` → `develop`)
- [ ] 現在のブランチを確認（必ず実行すること）
- [ ] **ベースブランチを最新化**（必ず実行すること）
  ```bash
  git checkout develop
  git pull origin develop
  ```
- [ ] **作業ブランチを作成**（必ず実行すること）
  ```bash
  git checkout -b feature/<機能名>
  ```

#### ✅ **ステップ 2**: 既存テストの実行（変更前） 🔴 必須実行
- [ ] **単体テストを実行**し、全テスト合格を確認（必ず実行すること）
  ```bash
  npm test
  ```
- [ ] **E2Eテストを実行**し、全テスト合格を確認（必ず実行すること）
  ```bash
  # Windows (PowerShell)
  Start-Process pwsh -ArgumentList "-Command", "npm run dev" -WindowStyle Hidden
  Start-Sleep -Seconds 5
  npm run test:e2e
  $viteProcess = Get-NetTCPConnection -LocalPort 5173 -ErrorAction SilentlyContinue | Select-Object -ExpandProperty OwningProcess -Unique
  if ($viteProcess) { Stop-Process -Id $viteProcess -Force -ErrorAction SilentlyContinue }
  ```

#### ✅ **ステップ 3**: コード変更の実施
- [ ] 依頼内容に沿ったコード変更を実施
- [ ] **既存ファイルを削除する場合**（コード統合、ファイル移動などで不要になった場合）
  ```bash
  # 必ず git rm コマンドを使用すること
  git rm <削除するファイルパス>
  ```
- [ ] TypeScriptのコンパイルエラーがないことを確認
  ```bash
  npx tsc --noEmit
  ```

#### ✅ **ステップ 3.5**: ユーザー確認 🔴 必須実行
- [ ] **変更内容をユーザーに報告**（必ず実行すること）
- [ ] **ユーザーの承認を待つ**
  - ✅ **OK**: ステップ4に進む
  - ❌ **NG**: ステップ3に戻り、フィードバックに基づいて再度変更

#### ✅ **ステップ 4**: ビルド確認
- [ ] **プロダクションビルドが成功**することを確認
  ```bash
  npm run build
  ```

#### ✅ **ステップ 5**: 単体テストの再実行（変更後）
- [ ] **単体テストを再実行**し、全テスト合格を確認
  ```bash
  npm test
  ```

#### ✅ **ステップ 6**: 単体テストの追加・変更（必要に応じて）
- [ ] **変更内容に応じて単体テストを追加・変更**する
  - **新しい関数・モジュールを追加した場合**: 対応するテストを追加
  - **新しいロジックを追加した場合**: 新規ロジックのテストを追加
  - **カバレッジ目標**: 新規コードは85%以上
- [ ] **追加・変更が不要な場合は、その理由をユーザーに報告**する

#### ✅ **ステップ 7**: E2Eテストの再実行（変更後） 🔴 必須実行
- [ ] **E2Eテストを再実行**し、全テスト合格を確認（必ず実行すること）
  ```bash
  # Windows (PowerShell)
  Start-Process pwsh -ArgumentList "-Command", "npm run dev" -WindowStyle Hidden
  Start-Sleep -Seconds 5
  npm run test:e2e
  $viteProcess = Get-NetTCPConnection -LocalPort 5173 -ErrorAction SilentlyContinue | Select-Object -ExpandProperty OwningProcess -Unique
  if ($viteProcess) { Stop-Process -Id $viteProcess -Force -ErrorAction SilentlyContinue }
  ```

#### ✅ **ステップ 8**: 最終確認
- [ ] ESLintでコード品質を確認
  ```bash
  npm run lint
  ```
- [ ] ローカル環境でアプリケーションを起動し、動作確認
  ```bash
  npm run dev
  ```

#### ✅ **ステップ 9**: コミット前の最終確認 🔴 必須実行
- [ ] 変更内容を確認（必ず実行すること）
  ```bash
  git status
  git diff
  ```
- [ ] **削除されたファイルの確認**（ファイル削除を行った場合）
- [ ] 不要なファイル（一時ファイル、デバッグコードなど）が含まれていないことを確認

#### ✅ **ステップ 9.5**: ユーザー承認 🔴 必須実行
- [ ] **git操作の実行許可をユーザーに確認**（必ず実行すること）
- [ ] **ユーザーの承認を待つ**
  - ✅ **OK**: ステップ10に進む
  - ❌ **NG**: 変更内容を修正してから再度確認

#### ✅ **ステップ 10**: コミットとプッシュ 🔴 必須実行
- [ ] 変更をステージングしてコミット（必ず実行すること）
  ```bash
  git add <変更したファイル>
  git commit -m "feat: <機能名>"
  ```
- [ ] リモートリポジトリにプッシュ
  ```bash
  git push origin feature/<機能名>
  ```

#### ✅ **ステップ 11**: プルリクエストの作成 🔴 必須実行
- [ ] プルリクエストを作成（必ず実行すること）
- [ ] @create-pull-request.mdc の**全ステップを自動実行**すること

## 機能エンハンスの定義

以下のような作業が機能エンハンスに該当します：
- 新機能の追加
- 既存機能の拡張
- 新しいUIコンポーネントの追加
- 新しい計算ロジックの追加
- 新しいデータ表示機能の追加
- 新しい設定項目の追加
- ユーザビリティの向上（機能追加を伴う場合）

## 実装の進め方

### 1. 設計フェーズ
- 型定義から開始（`src/types/` に追加）
- インターフェースを設計
- データフローを設計

### 2. 実装フェーズ
- ビジネスロジックを実装（`src/lib/` に追加）
- UIコンポーネントを実装（`src/components/` に追加）
- ストアを追加・更新（必要に応じて）

### 3. テストフェーズ
- 単体テストを追加（`src/**/__tests__/*.test.ts(x)`）
- E2Eシナリオを追加（`tests/e2e/*.spec.ts`）
- カバレッジ目標: 新規コードは85%以上

### 4. ドキュメントフェーズ
- コード内のコメントを充実させる
- 複雑なロジックには仕様コメントを追加

## コミットメッセージ形式

```
feat: <機能名>
```

**例**:
- `feat: 採掘速度計算機能を追加`
- `feat: レシピ比較モーダルを追加`
- `feat: JSONエクスポート機能を追加`
- `feat: What-Ifシミュレーターを追加`

## PR作成時の自動設定

- **PRタイトル**: `feat: <機能名>`
- **PR先**: `develop` ブランチ
- **Issue紐付け**: `Closes #<Issue番号>` が自動的に追加されます
- **品質保証結果**: 単体テスト、E2Eテスト、ビルド、ESLintの結果が自動的に記載されます

## 注意事項

1. **新機能のテストは必須**
   - 新しい関数・モジュールには必ず単体テストを追加してください
   - カバレッジ目標: 新規コードは85%以上

2. **E2Eテストも追加を検討**
   - ユーザーフローに影響がある場合、E2Eテストを追加してください
   - `tests/e2e/` に新しいシナリオを追加

3. **段階的な実装を推奨**
   - 大規模な機能は複数のPRに分割してください
   - 各PRで独立してテスト可能にしてください

4. **既存機能への影響を確認**
   - 新機能が既存機能に影響を与えないか確認してください
   - 全てのE2Eテストが合格することを確認してください

5. **ユーザビリティを考慮**
   - 新機能は直感的で使いやすいUIを心がけてください
   - 必要に応じて説明やツールチップを追加してください

6. **パフォーマンスを考慮**
   - 新機能がアプリケーション全体のパフォーマンスに影響しないか確認してください
   - 必要に応じてメモ化やレイジーロードを検討してください

## 実装パターンの参照

新機能を実装する際は、以下のドキュメントを参照してください：
- `@TypeScript.mdc` - TypeScript実装パターン
- `@coding.mdc` - 設計原則
- プロジェクトルート `.cursor/rules/` - プロジェクト固有のルール

## コードレビュー時のチェックポイント

- [ ] 型定義が適切か
- [ ] ビジネスロジックがUIから分離されているか
- [ ] テストカバレッジが十分か
- [ ] E2Eテストが追加されているか（必要に応じて）
- [ ] コードコメントが充実しているか
- [ ] ESLintエラーがないか
- [ ] TypeScriptコンパイルエラーがないか
- [ ] パフォーマンスへの影響がないか

---

**このコマンドは `@development-workflow.mdc` と `@create-pull-request.mdc` の全ルールに従って実行されます。**

