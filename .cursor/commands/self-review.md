# 自己レビューコマンド

このコマンドは、コミット前に自分でコードレビューを実施するためのコマンドです。

## 使用方法

```
/self-review
```

**オプション**:
- `/self-review` - 全チェック実行（デフォルト）
- `/self-review quick` - 重要項目のみチェック（高速）

## 実行内容

### ステップ 1: 変更内容の確認

- [ ] **変更ファイルのリストを確認**
  ```bash
  git status
  ```

- [ ] **差分の統計を確認**
  ```bash
  git diff --stat
  ```

- [ ] **変更内容の詳細を確認**
  ```bash
  git diff
  ```

### ステップ 2: 自動チェック項目

以下の観点で自動的にチェックを実施：

#### 2.1 コード品質チェック

- [ ] **未使用のimportがないか**
  - TypeScriptの未使用変数をチェック
  - `grep` で未使用のimportを検出
  - 例: `import { unused } from './module'` で使用されていない変数

- [ ] **console.log() が残っていないか**
  - `grep -r "console\\.log" src/` で検出
  - デバッグコードが残っていないか確認
  - `console.warn()`, `console.error()` も確認

- [ ] **TODOコメントが適切か**
  - `grep -r "TODO" src/` で検出
  - TODOコメントに具体的な内容が記載されているか
  - 不要なTODOが残っていないか

- [ ] **型定義が十分か（any の使用を避けているか）**
  - `grep -r ": any" src/` で検出
  - `any` の使用箇所をリストアップ
  - より具体的な型を提案

#### 2.2 テストチェック

- [ ] **テストが追加されているか**
  - 新しい関数・モジュールに対応するテストファイルがあるか
  - `src/**/__tests__/*.test.ts(x)` を確認
  - テストカバレッジが十分か（85%以上）

- [ ] **テストの内容が適切か**
  - エッジケースがテストされているか
  - 正常系・異常系の両方がテストされているか
  - テストの説明（it/describe）が分かりやすいか

#### 2.3 コメントチェック

- [ ] **コメントが十分か**
  - 複雑なロジックにコメントがあるか
  - 関数の仕様コメントがあるか
  - なぜその実装をしたのか説明があるか

- [ ] **JSDocコメントが適切か**
  - 公開関数にJSDocコメントがあるか
  - パラメータの説明があるか
  - 戻り値の説明があるか

#### 2.4 命名チェック

- [ ] **命名が適切か**
  - 変数名が内容を表しているか
  - 関数名が動作を表しているか
  - 略語を使いすぎていないか
  - 型名が明確か

- [ ] **命名規則に従っているか**
  - camelCase: 変数・関数
  - PascalCase: 型・コンポーネント・クラス
  - UPPER_SNAKE_CASE: 定数
  - kebab-case: ファイル名（一部例外あり）

#### 2.5 ファイルチェック

- [ ] **不要なファイルが含まれていないか**
  - 一時ファイル（*.tmp, *.bak など）
  - デバッグ用ファイル
  - 個人的なメモファイル
  - `.cursor/rules/` の不要な変更

- [ ] **削除すべきファイルが削除されているか**
  - 統合された古いファイル
  - 使用されなくなったファイル
  - `git rm` で削除されているか（`rm` ではなく）

#### 2.6 依存関係チェック

- [ ] **新しい依存関係が適切か**
  - `package.json` の変更を確認
  - 本当に必要な依存関係か
  - バージョン指定が適切か
  - `devDependencies` / `dependencies` の区別が正しいか

#### 2.7 セキュリティチェック

- [ ] **機密情報が含まれていないか**
  - APIキー、パスワードなど
  - 個人情報
  - 環境変数に移すべき情報

### ステップ 3: 潜在的な問題の指摘

以下のような潜在的な問題を検出して指摘：

1. **パフォーマンス問題**
   - 不要な再レンダリング
   - メモ化されていない重い計算
   - 無限ループの可能性

2. **バグの可能性**
   - Null参照の可能性
   - 配列の範囲外アクセス
   - 型キャストの不適切な使用

3. **保守性の問題**
   - 長すぎる関数（100行以上）
   - 深すぎるネスト（4階層以上）
   - 重複コード

4. **アクセシビリティの問題**
   - alt属性の欠如
   - aria属性の不足
   - キーボード操作への対応不足

### ステップ 4: レビューチェックリストの生成

以下のチェックリストを生成してユーザーに提示：

```markdown
## 自己レビューチェックリスト

### コード品質
- [ ] 未使用のimportを削除した
- [ ] console.log() などのデバッグコードを削除した
- [ ] TODOコメントを整理した
- [ ] any の使用を避けた（または正当な理由がある）

### テスト
- [ ] 新しいコード・ロジックにテストを追加した
- [ ] エッジケースをテストした
- [ ] テストカバレッジが85%以上ある

### ドキュメント
- [ ] 複雑なロジックにコメントを追加した
- [ ] 関数の仕様コメントを追加した
- [ ] 公開APIにJSDocコメントを追加した

### 命名
- [ ] 変数・関数の命名が分かりやすい
- [ ] 命名規則に従っている
- [ ] 略語を使いすぎていない

### ファイル
- [ ] 不要なファイルを削除した（git rm）
- [ ] 一時ファイルが含まれていない
- [ ] .cursor/rules/ の不要な変更がない

### セキュリティ
- [ ] 機密情報が含まれていない
- [ ] APIキー・パスワードが環境変数化されている

### パフォーマンス
- [ ] 不要な再レンダリングがない
- [ ] 重い計算がメモ化されている

### アクセシビリティ
- [ ] alt属性が適切に設定されている
- [ ] キーボード操作に対応している

### その他
- [ ] ESLintエラーがない
- [ ] TypeScriptコンパイルエラーがない
- [ ] ビルドが成功する
- [ ] 全テストが合格する
```

### ステップ 5: 修正の提案

検出された問題について、具体的な修正方法を提案：

1. **未使用のimport**: 削除するコマンドを提示
2. **console.log()**: 削除箇所を指摘
3. **any の使用**: より具体的な型を提案
4. **テスト不足**: テストファイルのテンプレートを提案
5. **命名の問題**: より良い命名を提案

## 使用例

### 例1: 通常の自己レビュー

```bash
/self-review

# 実行結果:
# ✅ 変更内容を確認中...
#   - 変更ファイル: 5個
#   - 追加行: 200行
#   - 削除行: 150行
#
# 🔍 自動チェック実行中...
#
# ⚠️  以下の問題が検出されました:
#
# 1. 未使用のimport (src/lib/calculator.ts:3)
#    import { unusedFunction } from './helpers'
#    → 削除を推奨
#
# 2. console.log() が残っています (src/components/ResultTree/ResultTree.tsx:45)
#    console.log('Debug:', result)
#    → 削除してください
#
# 3. any の使用 (src/lib/parser.ts:78)
#    const data: any = await response.json()
#    → より具体的な型を使用してください（例: GameData）
#
# 4. テストが不足しています
#    新しい関数 calculateMiningSpeed() にテストがありません
#    → src/lib/__tests__/miningCalculation.test.ts を作成してください
#
# ✅ レビューチェックリストを生成しました
# 📋 上記の問題を修正してからコミットしてください
```

### 例2: 高速レビュー

```bash
/self-review quick

# 実行結果:
# ✅ 重要項目のみチェック中...
#
# ✅ console.log(): なし
# ✅ any の使用: なし
# ✅ 機密情報: なし
# ✅ 不要なファイル: なし
#
# 🎉 重要な問題は検出されませんでした
# ⚠️  詳細レビューは /self-review で実行してください
```

## 注意事項

1. **自動チェックは完璧ではない**
   - 自動チェックは補助ツールです
   - 最終的には人間の目で確認してください

2. **コミット前に必ず実行**
   - コミット前に自己レビューを習慣化してください
   - レビュアーの負担を減らすことができます

3. **指摘された問題は必ず修正**
   - 警告を無視しないでください
   - 修正できない場合は理由をコメントに記載してください

4. **チェックリストは保存推奨**
   - PR本文に含めることもできます
   - レビュアーに対する説明になります

5. **継続的な改善**
   - 指摘された問題は今後避けるようにしてください
   - コーディングの質が向上します

## 品質保証ワークフローとの連携

このコマンドは、`@development-workflow.mdc` のステップ9「コミット前の最終確認」で使用することを推奨します：

```bash
# ステップ 8: 最終確認（ESLint、動作確認）
npm run lint
npm run dev

# ステップ 8.5: 自己レビュー 🆕
/self-review

# ステップ 9: コミット＆プッシュ
git add <変更ファイル>
git commit -m "feat: 新機能を追加"
git push origin <ブランチ名>
```

---

**自己レビューはコードの品質を保つための重要なステップです。コミット前に必ず実行してください。**

