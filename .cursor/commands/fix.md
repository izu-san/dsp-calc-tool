# 不具合修正作業開始コマンド

このコマンドは、不具合修正作業を開始するための専用コマンドです。

## 使用方法

```
/fix <Issue URL または Issue番号> <簡単な説明>
```

**例**:
- `/fix #78 増産剤計算エラー`
- `/fix https://github.com/owner/repo/issues/78 増産剤計算エラー`
- `/fix #78` (説明なしの場合はIssueタイトルを使用)

## 実行内容

このコマンドを実行すると、以下の作業を自動的に実行します：

### 1. Issue情報の抽出
- Issue URL または Issue番号から Issue 番号を抽出
- Issue番号は PR作成時に自動的に紐付けられます

### 2. ブランチ作成
- ベースブランチ: `main`
- ブランチ命名規則: `hotfix/fix-<問題の説明のスラッグ化>`
- 例: `hotfix/fix-calculation-error`

### 3. 作業タイプの設定
- 作業タイプ: **不具合修正**
- コミットプレフィックス: `fix:`
- PR先: `main` ブランチ

### 4. ワークフロー実行
`@development-workflow.mdc` の全ステップを自動実行：
1. ✅ ブランチ作成（mainから）
2. ✅ 既存テスト実行（変更前）
3. ✅ **バグを再現するテストを追加（TDD推奨）**
4. ✅ コード変更実施
5. ✅ **ユーザー確認（必須）** - ステップ3.5
6. ✅ ビルド確認
7. ✅ 単体テスト再実行
8. ✅ テスト追加・変更（バグ再現テスト）
9. ✅ E2Eテスト再実行
10. ✅ 最終確認（ESLint、TypeScript）
11. ✅ コミット＆プッシュ
12. ✅ PR作成（main ブランチへ、Issue番号を紐付け）

## 不具合修正の定義

以下のような作業が不具合修正に該当します：
- バグの修正
- 計算エラーの修正
- UI表示エラーの修正
- エッジケースでのエラー修正
- Null参照エラーの修正
- 型エラーの修正
- パフォーマンス問題の修正（機能に影響がある場合）

## テスト駆動開発（TDD）の推奨

不具合修正では、以下の手順を推奨します：

1. **バグを再現するテストを先に書く**
   ```typescript
   it('should handle edge case correctly', () => {
     // バグを再現する条件
     const result = calculateSomething(edgeCaseInput);
     // 期待する正しい結果
     expect(result).toBe(expectedValue);
   });
   ```

2. **テストが失敗することを確認**
   - バグが再現されていることを確認

3. **コードを修正してテストを合格させる**
   - 最小限の変更でバグを修正

4. **リグレッションテストとして残す**
   - 同じバグが再発しないようにテストを保持

## コミットメッセージ形式

```
fix: <修正内容>
```

**例**:
- `fix: 増産剤計算の誤りを修正`
- `fix: Null参照エラーを修正`
- `fix: レシピツリー表示のバグを修正`

## PR作成時の自動設定

- **PRタイトル**: `fix: <修正内容>`
- **PR先**: `main` ブランチ
- **Issue紐付け**: `Fixes #<Issue番号>` が自動的に追加されます
- **品質保証結果**: 単体テスト、E2Eテスト、ビルド、ESLintの結果が自動的に記載されます

## 注意事項

1. **mainブランチへの直接マージ**
   - 不具合修正は `main` ブランチに直接マージされます
   - 本番環境への影響が大きいため、慎重に確認してください

2. **バグ再現テストは必須**
   - バグを再現するテストがない場合、同じバグが再発する可能性があります
   - TDD（テスト駆動開発）を推奨します

3. **最小限の変更を心がける**
   - 不具合修正は最小限の変更で行ってください
   - リファクタリングは別のPRで実施してください

4. **E2Eテストも必ず実行**
   - UIレベルでのリグレッションを確認してください

5. **動作確認を徹底**
   - 修正後、手動でも動作確認を行ってください
   - 他の機能に影響がないことを確認してください

## 緊急度の高い修正の場合

- レビュアーに連絡し、優先的にレビューを依頼してください
- マージ後、`develop` ブランチへの反映（バックマージ）を忘れずに

---

**このコマンドは `@development-workflow.mdc` と `@create-pull-request.mdc` の全ルールに従って実行されます。**

