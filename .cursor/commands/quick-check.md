# 高速品質チェックコマンド

このコマンドは、コミット前の軽量な品質チェック（E2Eテストをスキップ）を実行します。

## 使用方法

```
/quick-check
```

**別名**: `/qc` (短縮形)

## 実行内容

このコマンドは、以下の4つのチェックを順番に実行します（E2Eテストをスキップして高速化）：

### 1. TypeScript コンパイルチェック

```bash
npx tsc --noEmit
```

- **目的**: 型エラーがないか確認
- **合格基準**: コンパイルエラー0件
- **実行時間**: 約5-10秒

**チェック内容**:
- 型の不整合
- 未定義変数の使用
- 型アサーションの誤り
- import/exportの誤り

### 2. ESLint チェック

```bash
npm run lint
```

- **目的**: コード品質・スタイルの確認
- **合格基準**: エラー0件、警告0件（または許容範囲内）
- **実行時間**: 約5-10秒

**チェック内容**:
- 未使用変数
- 潜在的なバグ
- コーディング規約違反
- ベストプラクティスからの逸脱

### 3. 単体テスト

```bash
npm test
```

- **目的**: ロジックレベルの動作確認
- **合格基準**: 全テスト成功（0 failed）
- **実行時間**: 約10-30秒

**チェック内容**:
- 関数・モジュールの動作
- エッジケースの処理
- エラーハンドリング
- リグレッションの確認

### 4. ビルドチェック

```bash
npm run build
```

- **目的**: プロダクションビルドが成功するか確認
- **合格基準**: エラーなしでビルド完了
- **実行時間**: 約20-40秒

**チェック内容**:
- バンドル可能か
- アセットが正しく処理されるか
- プロダクション環境で動作するか

## 合格基準

| 項目 | 合格基準 | 失敗時の影響 |
|---|---|---|
| **TypeScript** | コンパイルエラー0件 | 型安全性の欠如 |
| **ESLint** | エラー0件、警告0件 | コード品質の低下 |
| **単体テスト** | 全テスト成功（0 failed） | ロジックレベルのバグ |
| **ビルド** | エラーなしで完了 | 本番環境で動作しない |

**総合判定**: 上記4項目が全て合格で「✅ 品質チェック合格」

## スキップされる項目

このコマンドでは、以下の項目をスキップして高速化します：

- ❌ **E2Eテスト**（約13秒）- UIレベルの動作確認
- ❌ **カバレッジレポート生成**（約20-40秒）- テストカバレッジの詳細

**注意**: コミット前には `/test` コマンドで全テスト実行を推奨します。

## 実行時間

- **合計**: 約40秒〜1分30秒
- **比較**: 全テスト実行（`/test`）は約2-3分

**時間短縮**: E2Eテストをスキップすることで、約50%の時間短縮

## 使用例

### 例1: 開発中の高速フィードバック

```bash
# コード変更後、高速フィードバックを得たい
/quick-check

# 実行結果:
# ⏱️  高速品質チェック開始...
#
# [1/4] TypeScript コンパイルチェック...
# ✅ TypeScript: OK (0 errors)
#
# [2/4] ESLint チェック...
# ✅ ESLint: OK (0 errors, 0 warnings)
#
# [3/4] 単体テスト...
# ✅ 単体テスト: 45/45 passed
#
# [4/4] ビルドチェック...
# ✅ ビルド: OK
#
# 🎉 品質チェック合格！
# ⏱️  実行時間: 1分20秒
#
# ⚠️  注意: E2Eテストはスキップされました
# 📝 コミット前には /test で全テスト実行を推奨します
```

### 例2: 失敗時の出力

```bash
/quick-check

# 実行結果:
# ⏱️  高速品質チェック開始...
#
# [1/4] TypeScript コンパイルチェック...
# ✅ TypeScript: OK
#
# [2/4] ESLint チェック...
# ❌ ESLint: 2 errors, 1 warning
#
#   src/lib/calculator.ts
#     45:12  error  'result' is assigned a value but never used  @typescript-eslint/no-unused-vars
#     78:5   error  Unexpected console statement  no-console
#
# ❌ 品質チェック失敗
# 📝 上記のエラーを修正してから再実行してください
```

## エラーハンドリング

### TypeScriptエラーが発生した場合

```bash
# エラー詳細を確認
npx tsc --noEmit

# 特定のファイルのみチェック
npx tsc --noEmit <ファイル名>
```

**よくあるエラー**:
- 型の不整合: より具体的な型を使用
- 未定義変数: importを追加
- Null参照の可能性: オプショナルチェイニング（`?.`）を使用

### ESLintエラーが発生した場合

```bash
# 自動修正を試みる
npm run lint -- --fix

# 特定のファイルのみチェック
npm run lint -- <ファイル名>
```

**よくあるエラー**:
- 未使用変数: 削除するか、変数名の先頭に `_` を付ける
- console.log(): 削除するか、eslint-disable コメントを追加
- 型エラー: 型定義を修正

### 単体テストが失敗した場合

```bash
# 詳細なエラーメッセージを表示
npm test -- --reporter=verbose

# 特定のテストのみ実行
npm test -- <テストファイル名>
```

**失敗時の対応**:
1. エラーメッセージを確認
2. 失敗したテストを特定
3. コードまたはテストを修正
4. 再実行して確認

### ビルドが失敗した場合

```bash
# キャッシュをクリアして再ビルド
rm -rf node_modules dist
npm install
npm run build
```

**よくある原因**:
- 依存関係の問題: `npm ci` で再インストール
- 環境変数の不足: `.env` ファイルを確認
- アセットの問題: `public/` ディレクトリを確認

## 推奨される使用タイミング

### ✅ quick-checkを使うべきとき

1. **開発中の高速フィードバック**
   - コード変更後、すぐに動作確認したい
   - UIには変更がない（ロジックのみ変更）

2. **リファクタリング中**
   - コードの構造変更中
   - 動作が変わっていないか確認したい

3. **テスト駆動開発（TDD）中**
   - テスト→実装→テストのサイクルを高速化
   - E2Eテストは後でまとめて実行

4. **軽微な修正**
   - タイポ修正
   - コメント追加
   - import順序の変更

### ❌ 全テスト実行（/test）を使うべきとき

1. **コミット前**
   - 必ず全テスト実行して品質を保証

2. **UI変更後**
   - E2EテストでUIレベルの動作確認が必要

3. **PR作成前**
   - 全テスト合格を確認してからPR作成

4. **大規模な変更後**
   - リグレッションの可能性が高い
   - UIとロジックの両方に影響がある

## ワークフローへの組み込み

### 開発フロー例

```bash
# 1. コード変更
# ... コード編集 ...

# 2. 高速チェック（開発中）
/quick-check

# 3. さらに変更
# ... コード編集 ...

# 4. 再度高速チェック
/quick-check

# 5. コミット前に全テスト実行
/test

# 6. 全テスト合格後、コミット
git add <変更ファイル>
git commit -m "feat: 新機能を追加"
```

### TDD（テスト駆動開発）フロー

```bash
# 1. テストを書く
# ... テストコード追加 ...

# 2. 高速チェック（テストが失敗することを確認）
/quick-check
# → ❌ テスト失敗（期待通り）

# 3. 実装する
# ... 実装コード追加 ...

# 4. 高速チェック（テストが合格することを確認）
/quick-check
# → ✅ テスト合格

# 5. リファクタリング
# ... コード整理 ...

# 6. 高速チェック（動作が変わっていないことを確認）
/quick-check
# → ✅ テスト合格（リグレッションなし）

# 7. コミット前に全テスト実行
/test
```

## 他のコマンドとの比較

| コマンド | 実行時間 | E2Eテスト | カバレッジ | 用途 |
|---|---|---|---|---|
| `/test` | 約2-3分 | ✅ | ✅ | コミット前の完全チェック |
| `/quick-check` | 約40秒〜1分30秒 | ❌ | ❌ | 開発中の高速フィードバック |
| `/test unit` | 約10-30秒 | ❌ | ❌ | 単体テストのみ |
| `/test e2e` | 約13-20秒 | ✅ | ❌ | E2Eテストのみ |

## 注意事項

1. **E2Eテストはスキップされる**
   - UIレベルの動作確認はされません
   - コミット前には `/test` で全テスト実行を推奨

2. **カバレッジレポートは生成されない**
   - テストカバレッジの詳細は確認できません
   - 必要に応じて `/test coverage` を実行

3. **高速だが完全ではない**
   - あくまで開発中の補助ツールです
   - 最終的には全テスト実行が必要

4. **失敗したら必ず修正**
   - quick-checkで失敗した場合、必ず修正してください
   - 無視してコミットすると品質が低下します

---

**このコマンドは開発中の高速フィードバックツールです。コミット前には必ず `/test` で全テスト実行してください。**

