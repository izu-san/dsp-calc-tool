# Dyson Sphere Program - 計算ツール テスト計画書

作成日: 2025-10-27
対象 URL: http://localhost:5173/

## 概要
この文書は、Dyson Sphere Program 向け生産チェーン計算ツール（リポジトリ: `new_calc`）の E2E および主要機能のテスト計画です。草案の `TEST_PLAN.md` と E2E 項目書（`e2e-test-spec.md`）に記載されたシナリオ 1～24 を統合しています。

目的: 主要ユーザーフローの安定性確認、計算ロジックの正確性検証、永続化・入出力の堅牢性確認、国際化・アクセシビリティの回帰検出。

前提（共通）:
- 各シナリオは「クリーンブラウザ状態（localStorage と URL パラメータをクリア）」から開始すること。
- 自動化: Playwright（E2E）、Vitest（ユニット）。

## 共通前提
- テストは Playwright を利用して実行されます。
- 多くのテストで `initializeApp(page)` を使ってアプリ起動→データ読み込み→Welcomeモーダルを閉じる初期化を行っています。
- テストで利用される共通ヘルパー: `tests/e2e/helpers/common-actions.ts`（レシピ選択、目標数量設定、タブ切替、保存/読み込みUI取得等）。
- UIは `test-dataid` を使用して取得しています

## 実際の確認結果（Playwright による探索）
以下はローカル環境（http://localhost:5173/）を Playwright で実際に操作して確認した重要な UI 状態・セレクタ・挙動です。テスト実装時のセレクタ選定や期待値調整に利用してください。

- 起動直後に Welcome モーダルが表示される（テスト用 data-testid: `welcome-modal`）。モーダルは `スキップ`（data-testid: `welcome-skip-button`）や `次へ` ボタンで閉じる／遷移します。モーダルが残っていると背後の UI 操作がブロックされるため、E2E ではまずモーダルを閉じる操作を入れてください。
- ヘッダの言語セレクトは combobox で初期は日本語（表示: "🇯🇵 日本語"）。
- ヘッダの保存・共有ボタン:
	- `💾 保存` は初期は disabled（無効） → レシピ選択後に有効化される（実際に鉄インゴット選択で有効化確認）。
	- `🔗 URL共有` も同様に初期は disabled → プラン生成で有効化。
- レシピ一覧:
	- 検索テキストボックスのプレースホルダ: "レシピ、アイテム、素材を検索..."（ref:e179）
	- レシピ数表示: "161 レシピ 見つかりました"（実データ）
	- 各レシピ要素はテスト用に data-testid が付与されている（例: 鉄インゴットは `recipe-button-1101`）。このパターンを使うと安定して要素を取得できます。
- レシピ選択後の Settings 側の表示:
	- 選択したレシピ名とアイコンが Settings の「目標」領域に表示され、role=spinbutton の目標入力（初期値 "1"、単位: アイテム/秒）が現れます（ref:e860）。自動テストでは role=spinbutton または周辺のラベル "目標" をキーに取得してください。
	- Production Tree が自動生成され、タブ（生産チェーン／統計／建設コスト／発電設備）が利用可能になります。
	- Production Tree のルートノードは折りたたみコントロールを持ち、各ノードの詳細（設備名、必要台数、電力、ベルト情報、飽和度）が表示されます（例: アーク製錬所 × 1, 720.0 kW 等）。
- What-if / クイックアクション領域:
	- "増産剤最大" は有効、"ベルト最大" が disabled の例があった（環境依存）。E2E ではボタンの disabled 状態を検証することを推奨します。
- ベルト総速度の表示: 設定パネルに "ベルト総速度" として現在の合計（例: 30 アイテム/秒）が表示される。

### Playwright で検出した安定セレクタ（推奨）
以下はこのセッションで実際に検出したセレクタと Playwright での取得例です。自動化テストはこれらを優先して使ってください。

- Welcome（起動時）
	- モーダル本体: [data-testid="welcome-modal"]
	- スキップボタン: [data-testid="welcome-skip-button"]
	- 次へボタン: [data-testid="welcome-next-button"]
	- Playwright: await page.getByTestId('welcome-skip-button').click();

- ヘッダ / 共通操作
	- 言語セレクト: [data-testid="language-switcher-select"] — 初期は日本語 (document.documentElement.lang === 'ja')
	- 保存ボタン: [data-testid="save-button"] （初期は disabled、プラン作成で有効化）
	- 読み込みボタン: [data-testid="load-button"]
	- URL共有ボタン: [data-testid="url-share-button"]（ダウンロードや共有の前後状態を検査）

- レシピ一覧
	- 検索入力: [data-testid="recipe-search-input"] または placeholder="レシピ、アイテム、素材を検索..."（例: page.getByPlaceholder('レシピ、アイテム、素材を検索...')）
	- レシピボタン: data-testid のパターン `recipe-button-<sid>`（例: `recipe-button-1101` が鉄インゴット）
		- Playwright 例: await page.getByTestId('recipe-button-1101').click();
	- お気に入りボタン: `favorite-button-<sid>`

- Settings / 目標入力
	- 目標（target）入力: role=spinbutton（label に「目標」が付いている近傍を使うのが安定）
		- Playwright 例: await page.getByRole('spinbutton', { name: /目標/ }).fill('10');
	- ベルト総速度の表示: 設定パネル内にテキスト（例: "ベルト総速度" と "30 アイテム/秒"）があるため、テキスト検査で確認可

- Production Tree / 出力検証
	- タブ切替: 生産チェーン/統計/建設コスト/発電設備 はタブボタンとして列挙される（例: tab text が "生産チェーン"）
	- ルートノード（選択したレシピ）: ノード見出しにアイコンとレシピ名（例: 鉄インゴット）、下に設備名と必要台数・電力（例: アーク製錬所 × 1, 720.0 kW）を含む要素が現れる
		- Playwright: await expect(page.getByText('アーク製錬所 × 1')).toBeVisible(); または production-tree の近傍テキスト検査

- What-if / Quick Actions
	- クイックアクションのボタン群は存在する（例: 増産剤最大、ベルト最大、スタック最大）。要素は disabled 状態になることがあるため、 .isDisabled() を検証してください。

注: 上記はこの探索セッションで検出した実データに基づきます（data-testid の完全一覧がページ上に付与されています）。CI で安定させるためのベストプラクティス:

- まず Welcome モーダルを閉じる（`welcome-skip-button`）
- data-testid を優先して要素を取得（例: `recipe-button-<sid>`、`save-button`）
- i18n の切替を伴う検査では `document.documentElement.lang` の変化や、切替後の明示的な要素出現を待つ
- ダウンロード/アップロード/クリップボード操作は Playwright の専用ハンドラ（file chooser / download / clipboard）を利用する

---

注: 上記は 1 回の手動探索で確認したスナップショットに基づく観察です。CI で再現性を持たせるため、Playwright テストでは要素に data-testid（`recipe-button-<sid>` 等）や role を優先して参照し、必要に応じて待機（モーダル閉鎖、データロード完了）を入れてください。

---

## テスト環境と実行手順（簡易）
- 必要ソフト: Node.js 18+, npm
- ローカル起動（PowerShell）:
```pwsh
npm ci
npm run dev
# ブラウザで http://localhost:5173/ を開く
```
- Playwright 実行例:
```pwsh
npx playwright install
npx playwright test --project=chromium
```

注意: ダウンロード/アップロードを伴うテストは Playwright の download/filechooser 機構を使用すること。言語切替は i18n のロードタイミングに依存するため切替後の明示的な待機を入れる。

---

## シナリオ一覧（詳細）
下記は e2e-spec と草案を反映した全 24 シナリオです。各シナリオはテスターが再現できるよう「前提」「手順」「期待結果」「成功/失敗基準」を含みます。

(各シナリオは独立して実行可能であることを想定)

### シナリオ 01: Welcome モーダル
#### 01-01: モーダルの基本操作
##### 前提
- クリーンブラウザ

##### 手順
1. アプリにアクセスする
2. Dyson Sphere Program Production Calculator へようこそ！ モーダルが表示されていることを確認する
3. ステップ 1 / 3 が表示されていることを確認する
4. 次へボタンを操作
5. ステップ 2 / 3 が表示されていることを確認する
6. 戻るボタンを操作
7. ステップ 1 / 3 が表示されていることを確認する
8. 次へボタンを操作
9. 次へボタンを操作
10. ステップ 3 / 3 が表示されていることを確認する
11. 始めるボタンを操作
12. モーダルが閉じることを確認する

##### 期待値
- モーダルが表示・遷移・閉じられること

#### 01-02: モーダルをスキップ
##### 前提
- クリーンブラウザ

##### 手順
1. アプリにアクセスする
2. Dyson Sphere Program Production Calculator へようこそ！ モーダルが表示されていることを確認する
3. スキップボタンを操作
4. モーダルが閉じることを確認する

##### 期待値
- モーダルが表示・閉じられること

#### 01-03: モーダルが再表示されない
##### 前提
- クリーンブラウザ

##### 手順
1. アプリにアクセスする
2. Dyson Sphere Program Production Calculator へようこそ！ モーダルが表示されていることを確認する
3. スキップボタンを操作
4. モーダルが閉じることを確認する
5. ページをリロード(F5リロード)
6. yson Sphere Program Production Calculator へようこそ！ モーダルが表示されないことを確認する

##### 期待値
- 一度閉じたモーダルは再表示されないこと

### シナリオ 02: ゲームデータ読み込みと初期表示
#### 02-01: ゲームデータの初期表示
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 設定エリアが表示されていることを確認する
2. レシピ選択エリアが表示されていることを確認する
3. ItemsタブとBuildingsタブに全てのレシピが表示されていることを確認する
4. 生産チェーンエリアが表示されていることを確認する

##### 期待値
- 161 レシピ 見つかりましたと表示されていること
- レシピを選択してくださいと表示されていること

### シナリオ 03: メイン機能の確認
#### 03-01: Itemsタブのレシピを選択して計算結果が表示される
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `超磁性リング` を選択する
2. 目標のテキストフィールドに `2` を入力する
3. 生産チェーンの生産チェーンタブを確認する
4. 生産チェーンの統計タブを確認する
5. 生産チェーンの建設コストタブを確認する
6. 生産チェーンの発電設備タブを確認する

##### 期待値
- 生産チェーンタブにレシピツリーが表示されていること
- 統計タブに生産概要、原材料、中間生産物、最終生産物が表示されていること
- 建設コストタブに建設コストが表示されていること
- 発電設備タブに必要電力、発電設備行為性が表示されていること

#### 03-02: Buildingsタブのレシピを選択して計算結果が表示される
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. Buildingsタブを選択する
2. `星間物流ステーション` を選択する
3. 目標のテキストフィールドに `1` を入力する
4. 生産チェーンの生産チェーンタブを確認する
5. 生産チェーンの統計タブを確認する
6. 生産チェーンの建設コストタブを確認する
7. 生産チェーンの発電設備タブを確認する

##### 期待値
- 生産チェーンタブにレシピツリーが表示されていること
- 統計タブに生産概要、原材料、中間生産物、最終生産物が表示されていること
- 建設コストタブに建設コストが表示されていること
- 発電設備タブに必要電力、発電設備行為性が表示されていること

#### 03-03: 極大値の動作確認
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `宇宙マトリックス` を選択する
2. 目標のテキストフィールドに `9999999` を入力する
3. 生産チェーンの生産チェーンタブを確認する
4. 生産チェーンの統計タブを確認する
5. 生産チェーンの建設コストタブを確認する
6. 生産チェーンの発電設備タブを確認する

##### 期待値
- 生産チェーンタブにレシピツリーが表示されていること
- 統計タブに生産概要、原材料、中間生産物、最終生産物が表示されていること
- 建設コストタブに建設コストが表示されていること
- 発電設備タブに必要電力、発電設備行為性が表示されていること
- `Nan` や `Infinity` などの異常値が存在しないこと

#### 03-04: 最小値の動作確認
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `宇宙マトリックス` を選択する
2. 目標のテキストフィールドに `0.1` を入力する
3. 生産チェーンの生産チェーンタブを確認する
4. 生産チェーンの統計タブを確認する
5. 生産チェーンの建設コストタブを確認する
6. 生産チェーンの発電設備タブを確認する

##### 期待値
- 生産チェーンタブにレシピツリーが表示されていること
- 統計タブに生産概要、原材料、中間生産物、最終生産物が表示されていること
- 建設コストタブに建設コストが表示されていること
- 発電設備タブに必要電力、発電設備行為性が表示されていること
- `Nan` や `Infinity` などの異常値が存在しないこと

#### 03-04: 範囲外の値の動作確認
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `宇宙マトリックス` を選択する
2. 目標のテキストフィールドに `0.0001` を入力する
3. 生産チェーンの生産チェーンタブを確認する
4. 生産チェーンの統計タブを確認する
5. 生産チェーンの建設コストタブを確認する
6. 生産チェーンの発電設備タブを確認する

##### 期待値
- 生産チェーンタブにレシピツリーが表示されていること
- 統計タブに生産概要、原材料、中間生産物、最終生産物が表示されていること
- 建設コストタブに建設コストが表示されていること
- 発電設備タブに必要電力、発電設備行為性が表示されていること
- `Nan` や `Infinity` などの異常値が存在しないこと
- 目標の値が `0.1` になっていること

#### 03-05: 増産剤の設定（追加生産が使えるアイテム）
##### 確認するデータ
| 増産剤ランク | モード       | 
| ------------ | ------------ | 
| 増産剤Mk.I   | 追加生産     | 
| 増産剤Mk.I   | 生産速度上昇 | 
| 増産剤Mk.II  | 追加生産     | 
| 増産剤Mk.II  | 生産速度上昇 | 
| 増産剤Mk.III | 追加生産     | 
| 増産剤Mk.III | 生産速度上昇 | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `量子チップ` を選択する
2. 目標のテキストフィールドに `5` を入力する
3. データに基づいて増産剤ランクとモードを選択する

##### 期待値
- 生産チェーンの統計タブを確認し、施設数・電力・速度が期待通り変化すること

#### 03-06: 増産剤の設定（追加生産が使えないアイテム）
##### 確認するデータ
| 増産剤ランク | モード       | 
| ------------ | ------------ | 
| 増産剤Mk.I   | 生産速度上昇 | 
| 増産剤Mk.II  | 生産速度上昇 | 
| 増産剤Mk.III | 生産速度上昇 | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `ストレンジ物質対消滅燃料棒` を選択する
2. 目標のテキストフィールドに `2` を入力する
3. データに基づいて増産剤ランクとモードを選択する

##### 期待値
- このレシピでは追加生産モードは使用できません と表示されていること
- 生産チェーンの統計タブを確認し、施設数・電力・速度が期待通り変化すること

#### 03-07: 精錬設備の設定
##### 確認するデータ
| 設備名               | 
| -------------------- | 
| アーク製錬所         | 
| プレーン製錬所       | 
| 負エントロピー製錬所 | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `鉄インゴット` を選択する
2. 目標のテキストフィールドに `20` を入力する
3. データに基づいて増産剤ランクとモードを選択する

##### 期待値
- 生産チェーンの統計タブを確認し、施設数・電力・速度が期待通り変化すること

#### 03-08: 組立機の設定
##### 確認するデータ
| 設備名        | 
| -------------| 
| 組立機Mk.I    | 
| 組立機Mk.II   | 
| 組立機Mk.III  | 
| 再構成式組立機 | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `磁気コイル` を選択する
2. 目標のテキストフィールドに `20` を入力する
3. データに基づいて増産剤ランクとモードを選択する

##### 期待値
- 生産チェーンの統計タブを確認し、施設数・電力・速度が期待通り変化すること

#### 03-09: 化学プラントの設定
##### 確認するデータ
| 設備名          | 
| --------------- | 
| 化学プラント     | 
| 量子化学プラント | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `プラスチック` を選択する
2. 目標のテキストフィールドに `20` を入力する
3. データに基づいて増産剤ランクとモードを選択する

##### 期待値
- 生産チェーンの統計タブを確認し、施設数・電力・速度が期待通り変化すること

#### 03-10: マトリックスラボの設定
##### 確認するデータ
| 設備名           | 
| ----------------| 
| マトリックスラボ |  
| 自己進化ラボ     | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `情報マトリックス` を選択する
2. 目標のテキストフィールドに `10` を入力する
3. データに基づいて増産剤ランクとモードを選択する

##### 期待値
- 生産チェーンの統計タブを確認し、施設数・電力・速度が期待通り変化すること

#### 03-11: コンベアベルトの設定
##### 確認するデータ
| ベルトランク | スタックサイズ | 
| ------------ | -------------- | 
| Mk.I         | x1             | 
| Mk.II        | x1             | 
| Mk.III       | x1             | 
| Mk.III       | x2             | 
| Mk.III       | x3             | 
| Mk.III       | x4             | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `重力マトリックス` を選択する
2. 目標のテキストフィールドに `30` を入力する
3. データに基づいて増産剤ランクとモードを選択する

##### 期待値
- 生産チェーンの生産チェーンタブの重力マトリックスノードを確認し、ベルトの入力、出力、合計、飽和度が期待通り変化すること

#### 03-12: Production Tree の展開/折り畳み
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `重力子レンズ` を選択する
2. 目標のテキストフィールドに `3` を入力する
3. 生産チェーンのルートノードを展開/折りたたみ操作する
4. すべて展開/すべて折りたたみボタンを操作する

##### 期待値
- ノードの状態が正しく切り替わること

#### 03-13: Production Tree の展開/折り畳み状態の維持
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `重力子レンズ` を選択する
2. 目標のテキストフィールドに `3` を入力する
3. すべて展開ボタンを操作する
4. 生産設備の精錬設備と組立機の設定を変更する

##### 期待値
- ノードがすべて展開された状態が維持されること

#### 03-14: 代替レシピの表示
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `粒子ブロードバンド` を選択する

##### 期待値
-  代替レシピが表示されること

#### 03-15: 代替レシピが存在しないレシピの確認
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `鉄インゴット` を選択する

##### 期待値
-  代替レシピが表示されないこと

#### 03-16: 代替レシピの比較
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `ダイソンスフィアの部品` を選択する
2. `グラフェン` の比較ボタンを操作する
3. 選択ボタンを操作して代替レシピを変更する

##### 期待値
-  代替レシピの比較ウインドウが表示されること
-  生産チェーンに代替レシピが反映されること

####　03-17: レシピ検索機能
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 検索テキストフィールドに `鉄` と入力
2. `鋼鉄` を選択する

##### 期待値
- 49 レシピ 見つかりました　と表示されること
- レシピツリーが表示されていること

#### 03-18: お気に入り機能
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `チタンインゴット` のお気に入りボタンを操作する
2. お気に入りカテゴリを選択する
3. チタンインゴットのみが表示されることを確認する
4. ページをリロードする(F5リロード)
5. チタンインゴットがお気に入りに登録されていることを確認する

##### 期待値
- お気に入り(1) と表示されること
- ページリロード後もお気に入りが維持されていること

#### 03-19: What-if 分析とクイックアクション
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `エネルギーマトリックス` を選択する
2. 目標のテキストフィールドに `100` を入力する
3. すべて修正ボタンを操作する

##### 期待値
- ボトルネック検出と表示されていること
- ボトルネックなしに変化すること
- 生産チェーンの統計タブを確認し、施設数・電力・速度が期待通り変化すること

#### 03-20: 生産チェーンの電力表示
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `エネルギーマトリックス` を選択する
2. 目標のテキストフィールドに `10` を入力する
3. 統計タブで電力グラフを表示する

##### 期待値
- 電力グラフが表示されること
- 統計タブの生産概要の総電力＝電力グラフ内の総消費電力＝発電設備タブの必要電力　であること

#### 03-21: 生産チェーンの電力表示：増産剤あり
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `エネルギーマトリックス` を選択する
2. 目標のテキストフィールドに `10` を入力する
3. 増産剤タイプを`増産剤Mk.III`に設定する
4. 統計タブで電力グラフを表示する

##### 期待値
- 電力グラフが表示されること
- 統計タブの生産概要の総電力＝電力グラフ内の総消費電力＝発電設備タブの必要電力　であること

#### 03-22: 採掘計算機の設定
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `チタンインゴット` を選択する
2. 目標のテキストフィールドに `6` を入力する
3. 建設コストタブの採掘計算機で採掘速度研究、機械タイプ、作業速度を変化させる

##### 期待値
- 機械タイプが採掘機のとき、作業速度は操作できないこと
- 素材内訳の値が期待通り変化すること
- 統計タブに採掘設備のデータと電力変化が反映されること

#### 03-23: ノード個別設定のオーバーライド
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `電磁タービン` を選択する
2. 目標のテキストフィールドに `6` を入力する
3. 任意のノードでカスタム設定を使用し、増産剤と生産設備の設定をオーバーライドする

##### 期待値
- 該当ノードのみがオーバーライドされること

#### 03-24: 臨界光子生成機能が必要なレシピ
##### 確認するデータ
| 重力子レンズ | 増産剤 | 
| ------------ | ------ | 
| なし         | なし   | 
| あり         | なし   | 
| あり         | Mk.I   | 
| あり         | Mk.II  | 
| あり         | Mk.III | 

##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `宇宙マトリックス` を選択する
2. データに従って重力子レンズの有無や増産剤の有無を設定する
3. 放射線伝送効率のレベルを変更する

##### 期待値
- 光子生成設定エリアが表示されること
- 生産チェーンの`臨界光子`に設定が反映されること

#### 03-25: 臨界光子生成機能が不要なレシピ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `電磁タービン` を選択する

##### 期待値
- 光子生成設定エリアが表示されないこと

#### 03-26: 複数出力レシピの表示
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `X線クラッキング` を選択する

##### 期待値
- 生産チェーンに複数出力アイテムが表示されること
- 統計タブの最終生産物に複数アイテムが表示されること

#### 03-27: レシピ再選択時の生産チェーン維持
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `銅インゴット` を選択する
2. 生産チェーンが表示されることを確認する
3. 再度 `銅インゴット` を選択する

##### 期待値
- 生産チェーンの表示が維持されること

#### 03-28: テンプレート機能
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `電磁タービン` を選択する
2. テンプレート（序盤、中盤、後半、終盤、省電力）を順に適用して差分確認

##### 期待値
- テンプレート通りの設定が適用されること

### シナリオ 4: 発電設備機能
#### 04-01: 発電設備テンプレート
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 発電設備タブを開く
3. 発電設備テンプレートを一通り選択する

##### 期待値
- 発電設備構成で使用される設備が適切に選択されること

####  04-02: 設備を手動で設定
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 発電設備タブを開く
3. 発電設備を手動で切り替える
4. 燃料が必要な発電設備では燃料も手動で切り替える

##### 期待値
- 全パターンを網羅し、発電設備構成が正しく切り替わること

#### 04-03: 増産剤を設定（火力発電所）
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 発電設備タブを開く
3. `火力発電所` を選択する
4. `高エネルギーグラファイト` を選択する
5. 増産剤の設定を切り替える

##### 期待値
- 全ての増産剤を網羅し、台数と燃料消費が正しく増減すること

#### 04-04: 増産剤を設定（人工恒星）
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 発電設備タブを開く
3. `人工恒星` を選択する
4. `反物質燃料棒` を選択する
5. 増産剤の設定を切り替える

##### 期待値
- 全ての増産剤を網羅し、台数が正しく増減すること

### シナリオ 05: データのエクスポートとインポート
#### 05-01: json形式の正常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 増産剤、生産設備を任意のランクに設定する
3. 保存ボタンを押下する
4. JSONボタンを押下する
5. 読み込みボタンを押下する
6. 4でダウンロードしたJSONファイルを選択してインポートする

##### 期待値
- ダウンロードと復元が成功すること
- ダウンロードしたファイルの中身が正しいこと

#### 05-02: Markdown形式の正常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 増産剤、生産設備を任意のランクに設定する
3. 保存ボタンを押下する
4. Markdownボタンを押下する
5. 読み込みボタンを押下する
6. 4でダウンロードしたMarkdownファイルを選択してインポートする

##### 期待値
- ダウンロードと復元が成功すること
- ダウンロードしたファイルの中身が正しいこと

#### 05-03: csv形式の正常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 増産剤、生産設備を任意のランクに設定する
3. 保存ボタンを押下する
4. CSVボタンを押下する
5. 読み込みボタンを押下する
6. 4でダウンロードしたCSVファイルを選択してインポートする

##### 期待値
- ダウンロードと復元が成功すること
- ダウンロードしたファイルの中身が正しいこと

#### 05-04: Excel形式の正常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 増産剤、生産設備を任意のランクに設定する
3. 保存ボタンを押下する
4. Excelボタンを押下する
5. 読み込みボタンを押下する
6. 4でダウンロードしたExcelファイルを選択してインポートする

##### 期待値
- ダウンロードと復元が成功すること
- ダウンロードしたファイルの中身が正しいこと

#### 05-05: json形式の異常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 読み込みボタンを押下する
2. 無効なjsonファイルを選択してインポートする

##### 期待値
- 読み込みエラーが表示されること

#### 05-06: Markdown形式の異常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 読み込みボタンを押下する
2. 無効なMarkdownファイルを選択してインポートする

##### 期待値
- 読み込みエラーが表示されること

#### 05-07: csv形式の異常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 読み込みボタンを押下する
2. 無効なcsvファイルを選択してインポートする

##### 期待値
- 読み込みエラーが表示されること

#### 05-08: Excel形式の異常データ
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 読み込みボタンを押下する
2. 無効なExcelファイルを選択してインポートする

##### 期待値
- 読み込みエラーが表示されること

#### 05-09: URL共有
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. `デストロイヤー` を選択する
2. 増産剤、生産設備を任意のランクに設定する
3. URL共有ボタンを押下する
4. コピーボタンを押下する
5. コピーしたURLにアクセスする

##### 期待値
- クリップボードにURLがコピーされること
- アクセス先でレシピが復元されること

### シナリオ 06: 設定永続化とロケール設定
#### 06-01: 言語切替
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 初期状態は言語が ja であることを確認する
2. 言語を en に切り替える
3. ページをリロードする(F5リロード)

##### 期待値
- 言語が正しく切り替わること
- ページリロード後も言語が維持されていること

#### 06-02: localStorageによる設定永続化
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. 任意のレシピを選択する
2. 設定エリアで増産剤、生産設備、コンベアベルトを任意に変更する
3. ページをリロードする(F5リロード)

##### 期待値
- ページリロード後も設定やレシピが維持されていること

### シナリオ 07: ModSettings とカスタム XML アップロード
#### 07-01: MOD設定画面の表示
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. Ctrl+Shift+Mを押下する

##### 期待値
- Mod設定画面が開くこと

#### 07-02: カスタムレシピのアップロード（正常データ）
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. Ctrl+Shift+Mを押下する
2. 使用可能なカスタムレシピのxmlデータをアップロードする

##### 期待値
- XMLファイルの読み込みが正常終了すること

#### 07-03: カスタムレシピのアップロード（異常データ）
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. Ctrl+Shift+Mを押下する
2. 異常なカスタムレシピのxmlデータをアップロードする

##### 期待値
- XMLファイルの読み込みが失敗すること

#### 07-04: カスタム増産剤倍率
##### 前提
- クリーンブラウザ
- Welcomeモーダルが閉じられていること

##### 手順
1. Ctrl+Shift+Mを押下する
2. 生産倍率と速度倍率を変更する

##### 期待値
- 増産剤の倍率が正しく変更されていること


---

### Welcomeモーダルの閉じ方

```
// スキップボタンを押してモーダルを閉じる
await page.getByTestId('welcome-skip-button').click();

// レシピ選択エリアのItemsタブが存在することを確認する
await expect(page.getByTestId('items-tab')).toBeVisible();
```

### 付録: 全 recipe-button-<sid> 一覧（生成方法）

完全な `recipe-button-<sid>`（＝ゲームデータの Recipe SID）の一覧はソースの XML から生成できます。リポジトリに小さな生成スクリプトを追加しました:

- スクリプト: `scripts/generate-recipe-sids.cjs`
- 出力先: `docs/testing/RECIPE_SIDS.md`

実行（PowerShell）:

```pwsh
node scripts/generate-recipe-sids.cjs
```

スクリプトは `public/data/Recipes/Recipes_ja.xml` 内の `<SID>` タグを抽出してソート済みの一覧を `docs/testing/RECIPE_SIDS.md` に書き出します。CI やローカルでの再生成が簡単にできるため、テスト実行前にこのスクリプトを走らせて最新の SID 一覧を付録に反映してください。

（注）Playwright テストでは UI の `data-testid="recipe-button-<sid>"` を参照することで確実に該当レシピを選択できます。RECIPE_SIDS.md を生成したら、必要に応じて優先テスト対象の SID を TEST_PLAN の該当シナリオに追記してください。

## サンプルコマンド（PowerShell）
```pwsh
npm ci
npx playwright install
npm run dev
npx playwright test --project=chromium
```

## ノート
- ダウンロード/アップロード、クリップボード、クリティカルな i18n の検証は Playwright の専用ハンドラを利用する。
- 実行時にタイムアウト発生する場合は、該当テストに対して待機時間（timeout）拡張を検討する。

---

作成者: QA / 自動生成サマリ

